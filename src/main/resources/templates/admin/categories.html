<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="admin/layout :: ad-head"></head>

<body class="hold-transition skin-blue sidebar-mini">
	<div class="wrapper">

		<!-- Main Header -->
		<header th:replace="admin/layout :: ad-header"></header>
		<!-- Left side column. contains the logo and sidebar -->
		<aside th:replace="admin/layout :: ad-sidebar"></aside>

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- Content Header (Page header) -->
			<section class="content-header">
				<h1>
					Categories <small>Categories management</small>
				</h1>
				<ol class="breadcrumb">
					<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
					<li><a href="#"> Categories</a></li>
					<li class="active">List categories</li>
				</ol>
			</section>

			<!-- Main content -->
			<section class="content">
				<div class="row">
					<div class="col-md-4">
						<div class="box box-primary">
							<div class="box-header with-border">
								<h3 class="box-title">Add a new category</h3>
							</div>
							<!-- /.box-header -->
							<!-- form start -->
							<div class="box-body">
								<form role="form" th:action="@{/admin/categories}" method="post"
									th:object="${category}">
									<input type="hidden" th:field="*{id}" /> <input type="hidden"
										th:field="*{path}" />
									<div class="form-group"
										th:classappend="${#fields.hasErrors('name')?'has-error':''}">
										<label for="cateName">Name</label> <input type="text"
											class="form-control" th:field="*{name}"
											placeholder="Category name..."> <span
											class="help-block" th:if="${#fields.hasErrors('name')}"
											th:errors="*{name}"></span>
									</div>
									<div class="form-group"
										th:classappend="${#fields.hasErrors('slug')?'has-error':''}">
										<label for="cateSlug" class="label-slug">Slug:</label>
										<div style="margin-left: 38px;">
											<input type="text" th:field="*{slug}" style="width: 100%;">
										</div>
										<span class="help-block" th:if="${#fields.hasErrors('slug')}"
											th:errors="*{slug}"></span>
									</div>
									<div class="form-group"
										th:classappend="${#fields.hasErrors('parentCate')?'has-error':''}">
										<label>Parent</label> <select
											class="form-control select2 select2-hidden-accessible"
											style="width: 100%;" size="6" th:field="*{parentCate}">
											<option class="level-1" value="0" selected="selected">No parent</option>
											<option th:each="parent:${categories}"
												th:unless="${#strings.startsWith(parent.path,category.path + category.id + '/') or parent.id == category.id}"
												th:class="'level-'+${parent.level}" th:value="${parent.id}"
												th:text="${parent.name}"
												th:selected="${parent.id == category.parentCate}"></option>
										</select> <span class="help-block"
											th:if="${#fields.hasErrors('parentCate')}"
											th:errors="*{parentCate}"></span>
									</div>
									<div class="form-group">
										<label for="cateDesc">Description</label>
										<textarea class="form-control" th:field="*{desc}"
											placeholder="Description..." rows="3"></textarea>
									</div>

									<div class="box-footer">
										<button type="submit" class="btn btn-primary pull-right">Submit</button>
									</div>
								</form>
							</div>
							<!-- /.box-body -->
						</div>
						<!-- /.box -->
					</div>
					<!-- /.col -->

					<div class="col-md-8">
						<div th:if="${success}"
							class="alert alert-success alert-dismissable">
							<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
							<strong th:text="${success}">Success!</strong>
						</div>
						<div class="box">
							<div class="box-header">
								<h3 class="box-title">All categories</h3>
							</div>
							<!-- /.box-header -->
							<div class="box-body">
								<table id="example1" class="table table-bordered table-striped">
									<thead>
										<tr>

											<th>Name</th>
											<th>Description</th>
											<th>Slug</th>
											<th></th>
											<th></th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="category : ${categories}">

											<td th:text="${category.name}"></td>
											<td th:text="${category.desc}"></td>
											<td th:text="${category.slug}"></td>
											<td align="center"><a
												th:href="@{/admin/category/{id}/edit(id=${category.id})}"><span
													class="fa fa-pencil-square-o "></span></a></td>
											<td align="center"><a
												th:href="@{/admin/category/{id}/delete(id=${category.id})}"><span
													class="fa fa-trash"></span></a></td>
										</tr>

									</tbody>

								</table>
							</div>
							<!-- /.box-body -->
						</div>
						<!-- /.box -->
					</div>
					<!-- /.col -->
				</div>
				<!-- /.row -->
			</section>
			<!-- /.content -->
		</div>
		<!-- /.content-wrapper -->

		<!-- Main Footer -->
		<footer th:replace="admin/layout :: ad-footer"></footer>

		<!-- Control Sidebar -->
		<aside th:replace="admin/layout :: ad-aside"></aside>

		<div class="control-sidebar-bg"></div>
	</div>
	<!-- ./wrapper -->

	<th:block th:replace="admin/layout :: ad-scriptsrc"></th:block>
	<script>
		$("#name").focusout(function() {
			var Text = $(this).val();
			Text = slug(Text);
			$("#slug").val(Text);
		});

		var slug = function(str) {
			str = str.replace(/^\s+|\s+$/g, ''); // trim
			str = str.toLowerCase();

			// remove accents, swap ñ for n, etc
			var from = "ÁÄÂÀÃÅČÇĆĎÉĚËÈÊẼĔȆÍÌÎÏŇÑÓÖÒÔÕØŘŔŠŤÚŮÜÙÛÝŸŽàáạảãâầấậẩẫăằắặẳẵáäâàãåčçćďèéẹẻẽêềếệểễéěëèêẽĕȇìíịỉĩíìîïňñòóọỏõôồốộổỗơờớợởỡóöòôõøðřŕšťùúụủũưừứựửữúůüùûỳýỵỷỹýÿžþÞĐđßÆa·/_,:;";
			var to = "AAAAAACCCDEEEEEEEEIIIINNOOOOOORRSTUUUUUYYZaaaaaaaaaaaaaaaaaaaaaaacccdeeeeeeeeeeeeeeeeeeeiiiiiiiiinnoooooooooooooooooooooooorrstuuuuuuuuuuuuuuuuyyyyyyyzbBDdBAa------";
			for (var i = 0, l = from.length; i < l; i++) {
				str = str
						.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));
			}

			str = str.replace(/[^a-z0-9 -]/g, '') // remove invalid chars
			.replace(/\s+/g, '-') // collapse whitespace and replace by -
			.replace(/-+/g, '-'); // collapse dashes

			return str;
		};
	</script>
</body>
</html>